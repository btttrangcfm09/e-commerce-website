{
    email xuanbui2902@gmail.com
    admin off
}

# Main domain
exclusive.mom, www.exclusive.mom {
    # Frontend với proper MIME types
    handle / {
        root * /usr/share/caddy
        try_files {path} /index.html
        file_server {
            # Đảm bảo MIME types đúng
            mime_types {
                .html text/html
                .css text/css
                .js application/javascript
                .json application/json
                .svg image/svg+xml
                .png image/png
                .jpg image/jpeg
                .woff2 font/woff2
                .woff font/woff
            }
        }
    }
    
    # Backend API
    handle /api/* {
        reverse_proxy backend:5000 {
            header_up Host {host}
            header_up X-Real-IP {remote}
        }
    }
    
    # Uploads
    handle /uploads/* {
        root * /app/uploads
        file_server
        header Cache-Control "public, max-age=31536000"
    }
}

# HTTP redirect
:80 {
    redir https://{host}{uri} permanent
}

# Config dự phòng cho IP (self-signed cert)
# Nếu truy cập bằng IP hoặc domain chưa propagate
:443 {
    tls internal  # Self-signed certificate
    
    handle / {
        reverse_proxy frontend:3000
    }
    
    handle /api/* {
        reverse_proxy backend:5000
    }
}